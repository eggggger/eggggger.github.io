---
title: ã€è¯‘ã€‘Node.js Best Practices
date: 2017-11-19 20:32:12
tags:
  - Node
category: å†™ç 
---

[åŸæ–‡é“¾æ¥](https://github.com/i0natan/nodebestpractices)

<!--more-->
# å‰è¨€
è¿™æ˜¯ä¸€ä¸ªç®€è¯»ç‰ˆï¼Œæ²¡æœ‰ç¿»è¯‘åŸæ–‡ `Read More` é‡Œçš„å†…å®¹ï¼Œä¸è¿‡æ¯”è¾ƒé‡è¦çš„å†…å®¹æˆ‘éƒ½å°†å®ƒæå–å‡ºæ¥äº†ã€‚å¦å¤–ï¼Œä¸‹æ–‡ `PS:` å¼€å¤´çš„å†…å®¹æ˜¯æˆ‘ä¸ªäººçš„ä¸€äº›è¡¥å……ï¼Œå¹¶éå‡ºè‡ªåŸæ–‡ã€‚

# ç›®å½•

1. [é¡¹ç›®ç»“æ„](#1-é¡¹ç›®ç»“æ„)   
2. [é”™è¯¯å¤„ç†](#2-é”™è¯¯å¤„ç†)   
3. [ä»£ç é£æ ¼](#3-ä»£ç é£æ ¼)  
4. [æµ‹è¯•å’Œæ€»ä½“è´¨é‡](#4-æµ‹è¯•å’Œæ€»ä½“è´¨é‡)  
5. [æŠ•å…¥ç”Ÿäº§ä½¿ç”¨](#5-æŠ•å…¥ç”Ÿäº§ä½¿ç”¨)  
6. [å®‰å…¨ - å³å°†å‘å¸ƒ](#6-å®‰å…¨)  
7. [æ€§èƒ½ - å³å°†å‘å¸ƒ](#7-æ€§èƒ½)

# `1. é¡¹ç›®ç»“æ„`

## 1.1 ç»„ä»¶åŒ–ç»“æ„

 **TL;DR:**  æœ€å‘çˆ¹çš„è½¯ä»¶ç¼ºé™·å°±æ˜¯ç»´æŠ¤ä¸€ä¸ªåŒ…å«æˆç™¾ä¸Šåƒä¾èµ–å…³ç³»çš„è¶…å¤§ä»£ç åº“ï¼Œè¿™æ ·çš„å¤§æ€ªç‰©ä¸¥é‡çš„æ‹–æ…¢äº†æ–°åŠŸèƒ½çš„å¼€å‘é€Ÿåº¦ã€‚å› æ­¤ï¼Œå¯ä»¥å°†ä½ çš„ä»£ç æ‹†åˆ†æˆç»„ä»¶ï¼Œæ¯ä¸€ä¸ªç»„ä»¶éƒ½æœ‰è‡ªå·±çš„ç›®å½•æˆ–è€…ä¸“é—¨çš„ä»£ç åº“ï¼Œå¹¶ä¸”ç¡®ä¿æ¯ä¸€ä¸ªç»„ä»¶éƒ½å°è€Œç®€å•ã€‚

**Otherwise:** å½“æ–°åŠŸèƒ½çš„å¼€å‘è€…å¾ˆéš¾å¼„æ˜ç™½ä»£ç å˜åŠ¨æ‰€ä¼šé€ æˆçš„å½±å“å¹¶ä¸”å®³æ€•æ‰“ç ´å…¶ä»–ç»„ä»¶çš„ä¾èµ–æ—¶ â€”â€” éƒ¨ç½²å˜å¾—æ›´æ…¢å¹¶ä¸”é£é™©æ›´å¤§ã€‚è¿™æ—¶å€™æƒ³è¦å†è¿›è¡Œæ‰©å±•ååˆ†è‰°éš¾ï¼Œæ˜¯æ—¶å€™è€ƒè™‘æ‹†åˆ†ä¸šåŠ¡é€»è¾‘äº†ã€‚

**PS:** ä¸‹é¢æ˜¯ `Read More` é‡Œç»™çš„ä¾‹å­ï¼Œä¸è¿‡ä¸ªäººè§‰å¾—é¡¹ç›®ç»“æ„æ˜¯ä¸€ä¸ªè§ä»è§æ™ºçš„ä¸œè¥¿ï¼ŒMVC åŠå…¶ä¸€äº›å˜ç§ä¸ç®¡åœ¨ `SOA` è¿˜æ˜¯ `å¾®æœåŠ¡` ä¸‹éƒ½æœ‰å¹¿æ³›çš„åº”ç”¨ã€‚

```
Good: æŒ‰ç»„ä»¶åˆ’åˆ†
.
â”œâ”€â”€ componets
â”‚Â Â  â”œâ”€â”€ orders
â”‚Â Â  â”œâ”€â”€ products
â”‚Â Â  â””â”€â”€ users
â””â”€â”€ libraries

Bad: æŒ‰æŠ€æœ¯è§’è‰²åˆ’åˆ†
.
â”œâ”€â”€ controllers
â”œâ”€â”€ models
â”œâ”€â”€ tests
â”œâ”€â”€ utils
â””â”€â”€ views

```

ğŸ”— [**Read More: structure by components**](https://github.com/i0natan/nodebestpractices/blob/master/sections/projectstructre/breakintcomponents.md)

## 1.2 å°†ä½ çš„ app åˆ†å±‚ï¼Œé™åˆ¶ Express çš„è¾¹ç•Œ

**TL;DR:** æ¯ä¸ªç»„ä»¶éƒ½åº”è¯¥åŒ…å«åˆ†å±‚ â€”â€” ä¸€ä¸ªä¸“é—¨ç”¨äº Webï¼Œä¸šåŠ¡é€»è¾‘å’Œæ•°æ®è®¿é—®çš„å¯¹è±¡ã€‚å®ƒä¸ä»…èƒ½æœ‰ä¸€ä¸ªæ¸…æ™°çš„ [å…³æ³¨ç‚¹åˆ†ç¦»](https://zh.wikipedia.org/wiki/%E5%85%B3%E6%B3%A8%E7%82%B9%E5%88%86%E7%A6%BB)ï¼Œè¿˜èƒ½å¤§å¤§ç®€åŒ– `Mock` å’Œ `æµ‹è¯•` ç³»ç»Ÿã€‚è™½ç„¶è¿™æ˜¯ä¸€ç§éå¸¸å¸¸è§çš„æ¨¡å¼ï¼Œä½†æ˜¯ API å¼€å‘è€…è¿˜æ˜¯å€¾å‘äºæŠŠ Web å±‚å¯¹è±¡ (Express req, res) ä¼ é€’åˆ°ä¸šåŠ¡é€»è¾‘å’Œæ•°æ®å±‚ â€”â€” è¿™ä½¿å¾—ä½ çš„ç¨‹åºä¾èµ–äº Expressï¼Œå¹¶ä¸”åªèƒ½é€šè¿‡ Express è®¿é—®ã€‚

**Otherwise:** å°† Web å±‚å¯¹è±¡ä¸å…¶ä»–å±‚æ··åˆçš„åº”ç”¨ç¨‹åºå°†æ— æ³•é€šè¿‡æµ‹è¯•ä»£ç ï¼ŒCron ä»»åŠ¡å’Œå…¶ä»–éExpress ä»£ç è¿›è¡Œè°ƒç”¨ã€‚

**PS:** ä¸ä»…ä»…æ˜¯ `Express`ï¼Œåƒ `Koa`ã€`Hapi`ç”šè‡³ `HTTP Module` çš„ context å…¶å®éƒ½åº”è¯¥åšå¥½éš”ç¦»ã€‚

ğŸ”— [**Read More: layer your app**](https://github.com/i0natan/nodebestpractices/blob/master/sections/projectstructre/createlayers.md)


## 1.3 å°†é€šç”¨åŠŸèƒ½æ‰“æˆ NPM åŒ…

**TL;DR:** åœ¨å¤§å‹åº”ç”¨ç¨‹åºä¸­ï¼Œåƒæ—¥å¿—ï¼ŒåŠ å¯†ä¹‹ç±»çš„é€šç”¨åŠŸèƒ½åº”è¯¥è¢«å•ç‹¬å°è£…æˆä¸€ä¸ªç§æœ‰ NPM åŒ…ï¼Œè¿™ä½¿å¾—å®ƒä»¬èƒ½åœ¨ä¸åŒçš„é¡¹ç›®ä¸­å…±äº«ã€‚

**Otherwise:** ä½ ä¸å¾—ä¸é€ ä¸€ä¸ªå‘å¸ƒå’Œä¾èµ–çš„è½®å­ã€‚

ğŸ”— [**Read More: Structure by feature**](https://github.com/i0natan/nodebestpractices/blob/master/sections/projectstructre/wraputilities.md)

## 1.4 åˆ†ç¦» Express çš„ app å’Œ server

**TL;DR:** é¿å…åœ¨ä¸€ä¸ªå·¨å¤§çš„æ–‡ä»¶ä¸­å®šä¹‰æ•´ä¸ª `Express` åº”ç”¨ï¼Œå°†ä½ çš„ `Express` å®šä¹‰æ‹†åˆ†æˆæœ€å°‘ä¸¤ä¸ªæ–‡ä»¶ï¼šAPI å£°æ˜ï¼ˆapp.jsï¼‰å’Œ æœåŠ¡å£°æ˜ï¼ˆWWWï¼‰ã€‚è¦è·å¾—æ›´å¥½çš„ç»“æ„ï¼Œè¯·æŠŠä½ çš„ API å£°æ˜æ”¾åœ¨ç»„ä»¶ä¸­ã€‚

**Otherwise:** ä½ çš„ API åªèƒ½é€šè¿‡ HTTP è°ƒç”¨æ¥è¿›è¡Œæµ‹è¯•ï¼ˆç¼“æ…¢å¹¶ä¸”éš¾ä»¥ç”Ÿæˆä»£ç è¦†ç›–ç‡æŠ¥å‘Šï¼‰ã€‚æˆ–è®¸åœ¨å•ä¸ªæ–‡ä»¶ä¸­ç»´æŠ¤æ•°ç™¾è¡Œä»£ç å¹¶ä¸æ˜¯ä»€ä¹ˆéš¾äº‹ ![](http://ozlrjyp17.bkt.clouddn.com/62e721e4gw1et02g5wksrj200k00k3y9.jpg)ã€‚

**PS:** ä¸€èˆ¬å¯ä»¥æŠŠå…¶æ‹†æˆ app å’Œ server, server ç»“åˆå‘½ä»¤è¡Œå·¥å…·å¯ä»¥åšä¸€äº›å¯åŠ¨æ—¶çš„é…ç½®ã€‚

ğŸ”— [**Read More: separate Express 'app' and 'server'**](https://github.com/i0natan/nodebestpractices/blob/master/sections/projectstructre/separateexpress.md)


## 1.5 ä½¿ç”¨èƒ½è¯»å–ç¯å¢ƒå˜é‡ï¼Œå®‰å…¨å’Œåˆ†å±‚çº§çš„é…ç½®

**TL;DR:** ä¸€ä¸ªå®Œå–„çš„é…ç½®è®¾ç½®åº”è¯¥ç¡®ä¿ï¼š

* å¯ä»¥ä»æ–‡ä»¶å’Œç¯å¢ƒå˜é‡ä¸­è¯»å–é”®å€¼
* æ•æ„Ÿå†…å®¹ä¿å­˜åœ¨æäº¤ä»£ç ä¹‹å¤–
* é…ç½®æ˜¯åˆ†å±‚çº§çš„å¹¶ä¸”å®¹æ˜“æŸ¥æ‰¾

åªæœ‰å°‘æ•°å‡ ä¸ªåŒ…ç¬¦åˆä»¥ä¸Šæ¡ä»¶ï¼Œæ¯”å¦‚ [rc](https://github.com/dominictarr/rc)ã€ [nconf](https://github.com/indexzero/nconf) å’Œ [config](https://github.com/lorenwest/node-config)ã€‚

**Otherwise:** å¦‚æœä¸èƒ½æ»¡è¶³è¿™äº›é…ç½®è¦æ±‚ï¼Œå°†ä¼šä½¿å›¢é˜Ÿçš„å¼€å‘é™·å…¥å›°å¢ƒã€‚

ğŸ”— [**Read More: configuration best practices**](https://github.com/i0natan/nodebestpractices/blob/master/sections/projectstructre/configguide.md)


# `2. é”™è¯¯å¤„ç†`

## 2.1 ä½¿ç”¨ Async-Await æˆ– Promises è¿›è¡Œå¼‚æ­¥é”™è¯¯å¤„ç†

**TL;DR:** åœ¨å›è°ƒä¸­å¤„ç†å¼‚æ­¥é”™è¯¯å¯èƒ½æ˜¯æœ€ç³Ÿç³•çš„æ–¹å¼ã€‚ä½ èƒ½ç»™ä½ ä»£ç é€çš„æœ€å¥½çš„ç¤¼ç‰©å°±æ˜¯ä½¿ç”¨ä¸€ä¸ªå¯é çš„ `Promise` åº“æˆ–è€… `async-await ` ä½œä¸ºå›è°ƒæ–¹å¼çš„æ›¿ä»£ï¼Œè¿™ä½¿å¾—ä½¿ç”¨ä¸€äº›åƒ `try-catch` ä¸€æ ·æ›´ç´§å‡‘å’Œæ›´ç†Ÿæ‚‰çš„è¯­æ³•æˆä¸ºå¯èƒ½ã€‚

**Otherwise:** Node.JS å›è°ƒé£æ ¼ï¼Œ`function(error, response)` æ˜¯ä¸€ä¸ªè®©ä»£ç ä¸å¯ç»´æŠ¤çš„å¥½åŠæ³•ï¼Œ å› ä¸ºä»–ä½¿é”™è¯¯å¤„ç†å’Œæ­£å¸¸ä»£ç ç›¸æ··åˆï¼Œè¿‡åº¦åµŒå¥—ä»¥åŠååˆ†è¹©è„šçš„ç¼–ç æ–¹å¼ã€‚

**PS:** Node æœ€è®©äººè¯Ÿç—…çš„åœ°æ–¹ä¹‹ä¸€å°±æ˜¯å›è°ƒï¼Œä¸è¿‡ç°åœ¨å·²ç»æ˜¯ 2017 å¹´äº†ğŸ˜‘

ğŸ”— [**Read More: avoiding callbacks**](https://github.com/i0natan/nodebestpractices/blob/master/sections/errorhandling/asyncerrorhandling.md)

## 2.2 åªä½¿ç”¨å†…ç½®çš„ Error å¯¹è±¡

**TL;DR:** å¾ˆå¤šäººä½¿ç”¨å­—ç¬¦ä¸²æˆ–ä¸€äº›è‡ªå®šä¹‰ç±»å‹æŠ›å‡ºé”™è¯¯ â€”â€” è¿™ä¼šä½¿å¾—é”™è¯¯å¤„ç†é€»è¾‘å’Œæ¨¡å—ä¹‹é—´çš„äº’æ“ä½œå˜å¾—å¤æ‚ã€‚ä¸ç®¡ä½ æ˜¯ `reject promise`ã€ `throw exception` è¿˜æ˜¯ `emit error` åªä½¿ç”¨å†…ç½®çš„ Error å¯¹è±¡å¯ä»¥å¢åŠ ä¸€è‡´æ€§å¹¶ä¸”èƒ½é˜²æ­¢é”™è¯¯ä¿¡æ¯çš„ä¸¢å¤±ã€‚

**Otherwise:** å½“è°ƒç”¨æŸä¸ªç»„ä»¶æ—¶ï¼Œä¸èƒ½ç¡®å®šä¼šè¿”å›å“ªäº›é”™è¯¯ç±»å‹ä¼šè®©é”™è¯¯å¤„ç†å˜å¾—å¾ˆå›°éš¾ã€‚ç”šè‡³æ›´åçš„æƒ…å†µä¸‹ä½¿ç”¨è‡ªå®šä¹‰é”™è¯¯ç±»å‹ä¼šå¯¼è‡´é‡è¦çš„é”™è¯¯ä¿¡æ¯ä¸¢å¤±ï¼Œæ¯”å¦‚ stack trace !

**PS:** å­—ç¬¦ä¸²ä¹‹ç±»çš„è‡ªå®šä¹‰é”™è¯¯åº”è¯¥é¿å…ï¼Œä½†æ˜¯æ´¾ç”Ÿè‡ª Error å¯¹è±¡çš„å­é”™è¯¯ç±»å‹æœ‰æ—¶ä¼šä½¿é”™è¯¯å¤„ç†å˜å¾—æ›´åŠ çµæ´»å’Œæ–¹ä¾¿ã€‚

ğŸ”— [**Read More: using the built-in error object**](https://github.com/i0natan/nodebestpractices/blob/master/sections/errorhandling/useonlythebuiltinerror.md)

## 2.3 åŒºåˆ†æ“ä½œé”™è¯¯å’Œç¨‹åºå‘˜é”™è¯¯

**TL;DR:** 

* æ“ä½œé”™è¯¯ï¼ˆå¦‚ API æ”¶åˆ°ä¸€ä¸ªéæ³•çš„è¾“å…¥ï¼‰æŒ‡çš„æ˜¯é”™è¯¯å½±å“å®Œå…¨å·²çŸ¥å¹¶ä¸”å¯ä»¥è¢«å¦¥å–„å¤„ç†çš„æƒ…å†µ
* ç¨‹åºå‘˜é”™è¯¯ï¼ˆå¦‚ è¯•å›¾è¯»å–ä¸€ä¸ªæœªå®šä¹‰çš„å˜é‡ï¼‰åˆ™æ˜¯æŒ‡æœªçŸ¥çš„ä»£ç å¼‚å¸¸ï¼Œè¿™è¡¨æ˜éœ€è¦é€‚å½“çš„é‡å¯ç¨‹åºäº†

**Otherwise:** å½“å‡ºç°é”™è¯¯æ—¶ï¼Œä½ å¯èƒ½æ€»æ˜¯è¦é‡æ–°å¯åŠ¨åº”ç”¨ç¨‹åºï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆä»…ä»…å› ä¸ºä¸€ä¸ªæ¬¡è¦ä¸”å¯ä»¥é¢„æµ‹çš„æ“ä½œé”™è¯¯å°±è¦è®© ~5000 åœ¨çº¿ç”¨æˆ·ä¸èƒ½ä½¿ç”¨å‘¢ï¼Ÿåä¹‹ï¼Œå½“ä¸€ä¸ªæœªçŸ¥çš„é”™è¯¯ï¼ˆç¨‹åºå‘˜é”™è¯¯ï¼‰å‘ç”Ÿæ—¶ï¼Œä¿æŒåº”ç”¨ç¨‹åºä¸é€€å‡ºåˆ™å¯èƒ½ä¼šé€ æˆä¸å¯é¢„æµ‹çš„é—®é¢˜ã€‚åŒºåˆ†è¿™ä¸¤è€…å¯ä»¥åœ¨ä¸åŒçš„æƒ…å†µä¸‹å·§å¦™åœ°é‡‡å–ä¸€äº›å¤„ç†æ–¹æ³•ã€‚

  ğŸ”— [**Read More: operational vs programmer error**](https://github.com/i0natan/nodebestpractices/blob/master/sections/errorhandling/operationalvsprogrammererror.md)

## 2.4 é›†ä¸­å¤„ç†é”™è¯¯ï¼Œè€Œä¸æ˜¯åœ¨ Express ä¸­é—´ä»¶ä¸­

**TL;DR:** é”™è¯¯å¤„ç†é€»è¾‘ï¼Œå¦‚å‘ç®¡ç†å‘˜å‘é‚®ä»¶å’Œæ—¥å¿—è®°å½•ç­‰åº”è¯¥å°è£…åœ¨ä¸€ä¸ªä¸“ç”¨çš„å¯¹è±¡é‡Œï¼Œæ‰€æœ‰ç«¯ç‚¹ï¼ˆä¾‹å¦‚ `Express ä¸­é—´ä»¶`ï¼Œ`cron jobs`ï¼Œ`å•å…ƒæµ‹è¯•`ï¼‰åœ¨å‡ºç°é”™è¯¯æ—¶å¯ä»¥è°ƒç”¨ã€‚

**Otherwise:** ä¸åœ¨ä¸€ä¸ªåœ°æ–¹å¤„ç†é”™è¯¯å°†ä¼šå¯¼è‡´ä»£ç é‡å¤ï¼Œå¹¶ä¸”å¯èƒ½æ— æ³•æ­£ç¡®åœ°å¤„ç†é”™è¯¯ã€‚

**PS:** å…¶å®å¯ä»¥åœ¨ä¸Šå±‚ middleware é‡Œå¯¹æŠ›å‡ºçš„é”™è¯¯è¿›è¡Œç»Ÿä¸€æ•è·ï¼Œåˆ©ç”¨é”™è¯¯å¤„ç†å¯¹è±¡ï¼Œå¯¹å¸¦ status æˆ–è€…ç‰¹å®šä¿¡æ¯çš„é”™è¯¯è¿›è¡Œä¸“é—¨çš„å¤„ç†ï¼Œæ²¡å¸¦çš„åˆ™å¯ä»¥ç»Ÿä¸€å¤„ç†å¹¶æŠ›å‡º 500 é”™è¯¯ã€‚



ğŸ”— [**Read More: handling errors in a centralized place**](https://github.com/i0natan/nodebestpractices/blob/master/sections/errorhandling/centralizedhandling.md)

## 2.5 ä½¿ç”¨ Swagger æ–‡æ¡£æè¿° API é”™è¯¯

**TL;DR:** è®©è°ƒç”¨è€…çŸ¥é“ API å¯èƒ½ä¼šè¿”å›å“ªäº›é”™è¯¯ï¼Œä»¥ä¾¿ä»–ä»¬å¯ä»¥åœ¨ä¸å´©æºƒçš„æƒ…å†µä¸‹å¤„ç†è¿™äº›é—®é¢˜ã€‚é€šå¸¸è¿™å¯ä»¥ä½¿ç”¨ `Swagger` ä¹‹ç±»çš„ REST API æ–‡æ¡£å·¥å…·å®Œæˆã€‚

**Otherwise:** ä¸€ä¸ª API å®¢æˆ·ç«¯å¯èƒ½ä¼šå´©æºƒå¹¶é‡æ–°å¯åŠ¨ï¼Œå› ä¸ºä»–æ”¶åˆ°äº†ä¸€ä¸ªæ— æ³•ç†è§£çš„é”™è¯¯ã€‚æ³¨æ„ï¼šä½ ä¹Ÿå¯èƒ½æ˜¯ä½ è‡ªå·±çš„ API çš„è°ƒç”¨è€…ï¼ˆåœ¨å¾®æœåŠ¡ç¯å¢ƒä¸­éå¸¸å…¸å‹ï¼‰ã€‚

ğŸ”— [**Read More: documenting errors in Swagger**](https://github.com/i0natan/nodebestpractices/blob/master/sections/errorhandling/documentingusingswagger.md)

## 2.6 å½“ä¸€ä¸ªæœªçŸ¥çš„é”™è¯¯å‘ç”Ÿæ—¶ï¼Œä¼˜é›…çš„å…³é—­è¿›ç¨‹

**TL;DR:** å½“å‘ç”ŸæœªçŸ¥é”™è¯¯æ—¶ï¼Œä¸èƒ½ç¡®å®šåº”ç”¨ç¨‹åºçš„å¥åº·çŠ¶å†µã€‚é€šå¸¸çš„åšæ³•æ˜¯å»ºè®®ä½¿ç”¨åƒ `Forever` æˆ–`PM2` è¿™æ ·çš„è¿›ç¨‹ç®¡ç†å·¥å…·æ¥é‡æ–°å¯åŠ¨ã€‚

**Otherwise:** å½“é‡åˆ°é™Œç”Ÿçš„å¼‚å¸¸æ—¶ï¼ŒæŸä¸ªå¯¹è±¡å¯èƒ½å¤„äºé”™è¯¯çš„çŠ¶æ€ï¼ˆå¦‚ ä¸€ä¸ªå…¨å±€çš„äº‹ä»¶è§¦å‘å™¨å¯èƒ½å› ä¸ºä¸€äº›å†…éƒ¨é”™è¯¯ä¸å†äº§ç”Ÿäº‹ä»¶ï¼‰ï¼Œæ‰€æœ‰ä¾èµ–ä»–çš„åŠŸèƒ½å¯èƒ½ä¼šå¤±è´¥æˆ–è€…è¡¨ç°å¼‚å¸¸ã€‚


**PS:** å¯ä»¥ä½¿ç”¨ `uncaughtException` äº‹ä»¶æ•è·å¼‚å¸¸å¹¶åšä¸€äº›é”™è¯¯è¿½è¸ªå¤„ç†ï¼Œä½†æ˜¯æœ€å¥½ä¸è¦å¼ºè¡Œ catch ä½å¼‚å¸¸ã€‚

ğŸ”— [**Read More: shutting the process**](https://github.com/i0natan/nodebestpractices/blob/master/sections/errorhandling/shuttingtheprocess.md)


## 2.7 ä½¿ç”¨æˆç†Ÿçš„ logger å·¥å…·æ¥å¢åŠ é”™è¯¯å¯è§æ€§

**TL;DR:** ä¸€å¥—æˆç†Ÿçš„ `logger` å·¥å…·å¦‚ [Winston](https://github.com/winstonjs/winston), [Bunyan](https://github.com/trentm/node-bunyan) æˆ–è€… [Log4J](https://github.com/log4js-node/log4js-node) å¯ä»¥åŠ å¿«é”™è¯¯æŸ¥æ‰¾å’Œåˆ†æçš„é€Ÿåº¦ã€‚æ‰€ä»¥å¿˜æ‰ `console.log ` å§ã€‚

**Otherwise:** é€šè¿‡ `console.log` æµè§ˆæˆ–è€…ä¸å€ŸåŠ©æŸ¥è¯¢å·¥å…·å’Œæ—¥å¿—æŸ¥çœ‹å™¨æ‰‹åŠ¨çš„åœ¨æ‚ä¹±çš„æ–‡ä»¶ä¸­æŸ¥æ‰¾é”™è¯¯æˆ–è®¸ä¼šè®©ä½ åŠ ç­åˆ°å¾ˆæ™š![](http://ozlrjyp17.bkt.clouddn.com/62e721e4gw1et02g5wksrj200k00k3y9.jpg)ã€‚

**PS:** `logger` å·¥å…·é… `ELK/EFK` æ˜¯ä¸€ä¸ªå¸¸è§çš„è§£å†³æ–¹æ¡ˆ

ğŸ”— [**Read More: using a mature logger**](https://github.com/i0natan/nodebestpractices/blob/master/sections/errorhandling/usematurelogger.md)


## 2.8 ç”¨ä½ æœ€å–œæ¬¢çš„æµ‹è¯•æ¡†æ¶æµ‹è¯•é”™è¯¯æµç¨‹

**TL;DR:** æ— è®ºæ˜¯ä¸“ä¸šçš„è‡ªåŠ¨åŒ– QA è¿˜æ˜¯ æ™®é€šçš„å¼€å‘è€…æ‰‹åŠ¨æµ‹è¯• â€”â€” ç¡®ä¿ä½ çš„ä»£ç ä¸ä»…èƒ½æ»¡è¶³æ­£é¢æƒ…å†µï¼Œè¿˜èƒ½å¤„ç†å’Œè¿”å›åˆé€‚çš„é”™è¯¯ã€‚åƒ [Mocha](https://github.com/mochajs/mocha) & [chai](https://github.com/chaijs/chai) å¯ä»¥è½»æ¾çš„å¤„ç†è¿™ç§æƒ…å†µã€‚

**Otherwise:** å¦‚æœä¸è¿›è¡Œæµ‹è¯•ï¼Œæ— è®ºæ˜¯è‡ªåŠ¨çš„è¿˜æ˜¯æ‰‹åŠ¨çš„ï¼Œä½ éƒ½ä¸èƒ½ä¾é æˆ‘ä»¬çš„ä»£ç æ¥è¿”å›åˆåˆé€‚åˆé€‚åˆé€‚åˆé€‚é€‚çš„é”™è¯¯ã€‚æ²¡æœ‰æœ‰æ„ä¹‰çš„é”™è¯¯ç­‰äºæ²¡æœ‰é”™è¯¯å¤„ç†ã€‚

**PS:** æœ‰ä¸€å †å·¥å…·å¦‚ `mocha`ã€`ava`ã€`jest`ã€`supertest`ã€`sinon` ç­‰å¯ä»¥ä¾›ä½ é€‰æ‹©ã€‚

ğŸ”— [**Read More: testing error flows**](https://github.com/i0natan/nodebestpractices/blob/master/sections/errorhandling/testingerrorflows.md)


## 2.9 ä½¿ç”¨ APM äº§å“æ¥å‘ç°é”™è¯¯å’Œåœæœºæ—¶é—´

**TL;DR:** ç›‘æ§å’Œæ€§èƒ½äº§å“ï¼ˆåˆç§° APMï¼‰é€šè¿‡ä¸»åŠ¨è¯„ä¼°ä½ çš„ä»£ç æˆ– API æ¥çªå‡ºæ˜¾ç¤ºé”™è¯¯ï¼Œå´©æºƒæ•°æ®å’Œä½ ç–å¿½çš„æ€§èƒ½å·®çš„éƒ¨åˆ† ã€‚

**Otherwise:** ä½ å¯èƒ½ä¼šèŠ±å¾ˆå¤šç²¾åŠ›å»æµ‹é‡ API çš„æ€§èƒ½å’Œåœæœºæ—¶é—´ï¼Œè€Œä¸”å¾ˆå¯èƒ½ä½ æ°¸è¿œä¹Ÿä¸ä¼šå¯Ÿè§‰åˆ°å“ªäº›éƒ¨åˆ†æ‰æ˜¯æ˜¯çœŸå®ç¯å¢ƒä¸‹æœ€æ…¢çš„ï¼Œä»¥åŠä»–æ˜¯å¦‚ä½•å½±å“ç”¨æˆ·ä½“éªŒçš„ã€‚
          
ğŸ”— [**Read More: using APM products**](https://github.com/i0natan/nodebestpractices/blob/master/sections/errorhandling/apmproducts.md)

## 2.10 æ•è·æœªå¤„ç†çš„ promise rejections

**TL;DR:** ä»»ä½• promise å†…çš„å¼‚å¸¸éƒ½ä¼šè¢«åå™¬å’Œä¸¢å¼ƒï¼Œé™¤éä½ æ²¡æœ‰å¿˜è®°å»å¤„ç†ä»–ã€‚å³ä½¿ä½ è®¢é˜…äº† `process.uncaughtException`ä¹Ÿæ²¡ç”¨! å¯ä»¥æ³¨å†Œäº‹ä»¶åˆ° `process.unhandledRejection` æ¥é¿å…ã€‚

**Otherwise:** ä½ çš„é”™è¯¯å°†è¢«åå™¬ä¸ä¼šç•™ä¸‹ç—•è¿¹ï¼Œä½ å®Œå…¨ä¸å¿…æ‹…å¿ƒ![](http://ozlrjyp17.bkt.clouddn.com/62e721e4gw1et02g5wksrj200k00k3y9.jpg)ã€‚

**PS:** ä¸€èˆ¬åƒ `koa` ä¹‹ç±»çš„æ¡†æ¶ï¼Œå¯ä»¥åœ¨å†…éƒ¨è¿›è¡Œé”™è¯¯æ•è·å’Œå¤„ç†ã€‚

ğŸ”— [**Read More: catching unhandled promise rejection**](https://github.com/i0natan/nodebestpractices/blob/master/sections/errorhandling/catchunhandledpromiserejection.md)

## 2.11 å¿«é€Ÿå¤±è´¥ï¼Œä½¿ç”¨ä¸“ç”¨åº“æ¥æ ¡éªŒå‚æ•°

**TL;DR:** æ–­è¨€ API è¾“å…¥ï¼Œä»¥é¿å…åœ¨åé¢éš¾ä»¥è·Ÿè¸ªçš„æ¶å¿ƒé”™è¯¯ã€‚æ ¡éªŒä»£ç é€šå¸¸å¾ˆç¹çï¼Œé™¤éä½¿ç”¨åƒ [Joi](https://github.com/hapijs/joi) è¿™æ ·çš„éå¸¸é…·çš„è¾…åŠ©åº“ã€‚

**Otherwise:** ä½ æƒ³ä¸€ä¸‹ â€”â€” ä½ çš„å‡½æ•°éœ€è¦ä¸€ä¸ªæ•°å­—å‚æ•° `Discount`ï¼Œä½†æ˜¯è°ƒç”¨è€…å¿˜è®°ä¼ äº†ã€‚ç¨åä½ åœ¨ä½ çš„ä»£ç åˆ¤æ–­ `if Discount !== 0`ï¼Œé‚£ä¹ˆå®ƒå°†ä¼šå…è®¸ç”¨æˆ·ä½¿ç”¨æŠ˜æ‰£ã€‚OMGï¼Œä½ çœ‹åˆ°äº†å—ï¼Ÿè¿™æ˜¯ä¸€ä¸ªè®¨åŒçš„bugã€‚

ğŸ”— [**Read More: failing fast**](https://github.com/i0natan/nodebestpractices/blob/master/sections/errorhandling/failfast.md)

# `3 ä»£ç é£æ ¼`
**TL:DR:** ç•¥ ![](http://ozlrjyp17.bkt.clouddn.com/62e721e4gw1et02g5wksrj200k00k3y9.jpg)

**PS:** ä»£ç æ ¼å¼å¦‚ 4 æ ¼è¿˜æ˜¯ 2 æ ¼ç¼©è¿›ï¼Œæœ‰æ— åˆ†å·ç­‰éƒ½æ˜¯ç¨‹åºå‘˜ä»¬äº‰è®ºä¸ä¼‘çš„è¯é¢˜ã€‚ä¸ªäººè§‰å¾—æœ€å¥½çš„æ–¹æ¡ˆå°±æ˜¯éµå®ˆå›¢é˜Ÿå…±åŒåˆ¶å®šçš„æ ‡å‡†ï¼Œä½¿ç”¨ `Eslint` åŠå…¶æ’ä»¶é…åˆ CI æ¥åšè‡ªåŠ¨åŒ–æ£€æŸ¥ã€‚æ¯”è¾ƒå»ºè®®åŸºäº [airbnb](https://github.com/airbnb/javascript) åšä¸€äº›å®šåˆ¶ï¼ˆæ¯”å¦‚å»æ‰å…¶ä¸­çš„åˆ†å·é™åˆ¶ ğŸ˜€ï¼‰ã€‚

# `4 æµ‹è¯•å’Œæ€»ä½“è´¨é‡`

## 4.1 è‡³å°‘è¦ç¼–å†™ API ï¼ˆç»„ä»¶ï¼‰æµ‹è¯•

**TL;DR:** ç”±äºæ’æœŸå¾ˆçŸ­ï¼Œå¤§å¤šæ•°é¡¹ç›®éƒ½æ²¡æœ‰è¿›è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œæˆ–è€…æµ‹è¯•å·¥ç¨‹ç»å¸¸å¤±æ§å¹¶è¢«åºŸå¼ƒã€‚ å› æ­¤ï¼Œå¯ä»¥ä¼˜å…ˆé€‰æ‹© API æµ‹è¯•ï¼Œè¿™æ˜¯æœ€å®¹æ˜“ç¼–å†™çš„ï¼Œå¹¶èƒ½æä¾›æ¯”å•å…ƒæµ‹è¯•æ›´å¤šçš„è¦†ç›–ç‡ï¼ˆä½ ç”šè‡³å¯ä»¥ä½¿ç”¨ [Postman](https://www.getpostman.com/) è¿™æ ·çš„å·¥å…·æ¥è¿›è¡Œ API æµ‹è¯•è€Œæ— éœ€ç¼–å†™ä»£ç ï¼‰ã€‚ä¹‹åï¼Œå¦‚æœä½ æœ‰æ›´å¤šçš„èµ„æºå’Œæ—¶é—´ï¼Œå†ç»§ç»­è¿›è¡Œå•å…ƒæµ‹è¯•ï¼Œæ•°æ®åº“æµ‹è¯•ï¼Œæ€§èƒ½æµ‹è¯•ä¹‹ç±»çš„é«˜çº§æµ‹è¯•ã€‚

**Otherwise:** ä½ å¯èƒ½èŠ±äº†å¾ˆå¤šå¤©å»ç¼–å†™å•å…ƒæµ‹è¯•ï¼Œç»“æœåªå¾—åˆ°äº† 20% çš„ç³»ç»Ÿè¦†ç›–ç‡ã€‚

## 4.2 ä½¿ç”¨ ESLint + ç‰¹å®šçš„ Node è§„åˆ™æ’ä»¶æ¥æ£€æµ‹ä»£ç é—®é¢˜

**TL;DR:** `ESLint` æ˜¯ç”¨æ¥æ£€æŸ¥ä»£ç é£æ ¼çš„äº‹å®ä¸Šçš„æ ‡å‡†ï¼Œä¸ä»…å¯ç”¨äºè¯†åˆ«åŸºæœ¬çš„é—´è·é—®é¢˜ï¼Œè¿˜èƒ½ç”¨äºæ£€æµ‹ä¸¥é‡çš„ä»£ç åæ¨¡å¼ï¼Œä¾‹å¦‚å¼€å‘è€…æŠ›å‡ºé”™è¯¯è€Œæ²¡æœ‰è¿›è¡Œåˆ†ç±»ã€‚é™¤äº†åŒ…å« [Vanilla JavaScript](https://en.wikipedia.org/wiki/JavaScript#Vanilla_JavaScript) çš„ `ESLint` æ ‡å‡†è§„åˆ™ä¹‹å¤–ï¼Œè¿˜æ·»åŠ äº†ç‰¹å®šäº Node çš„æ’ä»¶ï¼Œå¦‚ `eslint-plugin-node`ï¼Œ`eslint-plugin-mocha` å’Œ`eslint-plugin-node-security`ã€‚

**Otherwise:** å¾ˆå¤šä¸è§„èŒƒçš„ Node.JS ä»£ç æ¨¡å¼å¯èƒ½åœ¨çœ¼çš®å­åº•ä¸‹è¢«æ¼è¿‡ã€‚ä¾‹å¦‚ï¼Œå¼€å‘è€…å¯èƒ½ç”¨ `require(variableAsPath)` å»åŠ è½½ç›¸å…³æ–‡ä»¶ï¼Œå…¶ä¸­çš„è·¯å¾„å˜é‡èƒ½è®©æ”»å‡»è€…æ‰§è¡Œä»»ä½• JS è„šæœ¬ã€‚Node.JS lingter å¯ä»¥æ£€æµ‹åˆ°è¿™ç§æ¨¡å¼å¹¶æå‰å‘ŠçŸ¥ã€‚

## 4.3 è°¨æ…åœ°é€‰æ‹©ä½ çš„CIå¹³å° ï¼ˆJenkins vs CircleCI vs Travis vs å…¶ä»–ï¼‰

**TL;DR:** ä½ çš„æŒç»­é›†æˆå¹³å°ï¼ˆCICDï¼‰å°†æ‰˜ç®¡æ‰€æœ‰è´¨é‡å·¥å…·â€‹â€‹ï¼ˆä¾‹å¦‚æµ‹è¯•ï¼Œlintï¼‰ï¼Œå› æ­¤å®ƒåº”è¯¥æ‹¥æœ‰å……æ»¡æ´»åŠ›çš„æ’ä»¶ç”Ÿæ€ç³»ç»Ÿã€‚[Jenkins](https://jenkins.io/) æ›¾ç»æ˜¯è®¸å¤šé¡¹ç›®çš„é»˜è®¤é€‰æ‹©ï¼Œå› ä¸ºå®ƒæ‹¥æœ‰æœ€å¤§çš„ç¤¾åŒºå’Œä¸€ä¸ªéå¸¸å¼ºå¤§çš„å¹³å°ï¼Œä½†æ˜¯å®ƒçš„ä»£ä»·åˆ™æ˜¯å¤æ‚çš„è®¾ç½®ä»¥åŠéœ€è¦ä¸€ä¸ªé™¡å³­çš„å­¦ä¹ æ›²çº¿ã€‚ç°åœ¨ï¼Œä½¿ç”¨  [CircleCI](https://circleci.com) ç­‰ `SaaS` å·¥å…·ä½¿ CI çš„è§£å†³æ–¹æ¡ˆå˜å¾—æ›´åŠ å®¹æ˜“ã€‚è¿™äº›å·¥å…·å…è®¸æ„å»ºçµæ´»çš„ CI ç®¡é“ï¼Œè€Œä¸éœ€è¦ç®¡ç†æ•´ä¸ªåŸºç¡€è®¾æ–½ã€‚æœ€ç»ˆï¼Œè¿™æ˜¯é²æ£’æ€§å’Œé€Ÿåº¦ä¹‹é—´çš„æƒè¡¡ â€”â€” è¯·è°¨æ…åœ°åšå‡ºä½ çš„é€‰æ‹©ã€‚

**Otherwise:** ä¸€æ—¦éœ€è¦ä¸€äº›é«˜çº§çš„å®šåˆ¶ï¼Œé€‰æ‹©ä¸€äº› CI å¹³å°å¯èƒ½ä¼šæˆä¸ºä½ çš„é˜»ç¢ã€‚è€Œå¦ä¸€æ–¹é¢ï¼Œä½¿ç”¨ `Jenkin` åˆ™å¯èƒ½ä¼šè®©ä½ å®è´µçš„æ—¶é—´æ¶ˆè€—åœ¨åŸºç¡€è®¾æ–½ä¸Šã€‚

ğŸ”— [**Read More: Choosing CI platform**](https://github.com/i0natan/nodebestpractices/blob/master/sections/testingandquality/citools.md)


## 4.4 ä¸æ–­åœ°æ£€æŸ¥æ˜“å—æ”»å‡»çš„ä¾èµ–é¡¹

**TL;DR:** å³ä¾¿æ˜¯æœ€å‡ºåçš„æ¨¡å—åŒ…ï¼Œä¾‹å¦‚ Expressï¼Œä¹Ÿå­˜åœ¨æ¼æ´ã€‚ä¾èµ–å®‰å…¨æ£€æŸ¥å¯ä»¥é€šè¿‡ä½¿ç”¨ç¤¾åŒºæˆ–å•†ä¸šåŒ–å·¥å…·ï¼ˆä¾‹å¦‚å¯ä»¥åœ¨æ¯ä¸ª CI æ„å»ºä¸­è°ƒç”¨ [nsp](https://github.com/nodesecurity/nsp) ï¼‰æ¥è½»æ¾å®ç°ã€‚

**Otherwise:** ä¸ç”¨ä¸“ç”¨å·¥å…·æ¥è¿›è¡Œä»£ç æ¼æ´ä¿æŠ¤ï¼Œé‚£ä¹ˆä½ éœ€è¦ä¸æ–­åœ°å…³æ³¨æœ‰å…³æ–°æ¼æ´çš„æ¶ˆæ¯ã€‚è¿™æ˜¯éå¸¸æ— èŠçš„ã€‚

## 4.5 æ ‡è®°ä½ çš„æµ‹è¯•

**TL;DR:** ä¸åŒçš„æµ‹è¯•å¿…é¡»åœ¨ä¸åŒçš„åœºæ™¯ä¸‹è¿è¡Œï¼š

* å†’çƒŸæµ‹è¯•åº”è¯¥åœ¨å¼€å‘äººå‘˜ä¿å­˜æˆ–æäº¤æ–‡ä»¶æ—¶è¿è¡Œ
* å®Œæ•´çš„ç«¯åˆ°ç«¯æµ‹è¯•é€šå¸¸åœ¨æäº¤æ–°çš„ `pull request` æ—¶è¿›è¡Œ
* å…¶ä»–ç­‰ç­‰

è¿™å¯ä»¥é€šè¿‡ä½¿ç”¨åƒ `#cold` `#api` `#sanity` ä¹‹ç±»çš„å…³é”®è¯æ ‡è®°æµ‹è¯•æ¥å®ç°ï¼Œè¿™æ ·ä½ å°±å¯ä»¥ç”¨ä½ çš„æµ‹è¯•å·¥å…· `grep` æ‰€è¦è°ƒç”¨å­é›†ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥ä½¿ç”¨ [Mocha](https://mochajs.org/) çš„`mocha --grep 'sanity'` æ¥è°ƒç”¨ `sanity` æµ‹è¯•ç»„

**Otherwise:** è¿è¡Œæ‰€æœ‰çš„æµ‹è¯•ï¼ŒåŒ…æ‹¬æ‰§è¡Œæ•°åä¸ªæ•°æ®åº“æŸ¥è¯¢çš„æµ‹è¯•ï¼Œä½¿å¾—ä»»ä½•æ—¶å€™å¼€å‘è€…åšä¸€ä¸ªå°æ”¹åŠ¨éƒ½ä¼šååˆ†ç¼“æ…¢ï¼Œå¹¶ä¸”è¿™ä¼šè®©å¼€å‘è€…è¿œç¦»æµ‹è¯•ã€‚


## 4.6 æ£€æŸ¥ä½ çš„æµ‹è¯•è¦†ç›–ç‡ï¼Œè¿™æœ‰åŠ©äºè¯†åˆ«é”™è¯¯çš„æµ‹è¯•æ¨¡å¼

**TL;DR:** ä»£ç è¦†ç›–ç‡å·¥å…·å¦‚ [Istanbul/NYC ](https://github.com/gotwarlost/istanbul)  æ˜¯éå¸¸ä¸é”™çš„é¡¹ç›®ï¼Œæœ‰ä¸‰ä¸ªåŸå› ï¼š

* å®ƒæ˜¯å…è´¹çš„ï¼ˆä¸ç”¨è´¹åŠ²æ¥è·å¾—è¿™ä¸ªæŠ¥å‘Šï¼‰
* å®ƒæœ‰åŠ©äºç¡®å®šæµ‹è¯•è¦†ç›–ç‡çš„ä¸‹é™
* å®ƒå¼ºè°ƒäº†æµ‹è¯•æœªè¦†ç›–çš„åœ°æ–¹ï¼šé€šè¿‡æŸ¥çœ‹å½©è‰²çš„ä»£ç è¦†ç›–ç‡æŠ¥å‘Šï¼Œä½ å¯èƒ½æ³¨æ„åˆ°çš„ï¼Œåƒ `catch` å­å¥é‚£æ ·çš„ä»£ç åŒºåŸŸå¹¶æ²¡æœ‰è¢«æµ‹è¯•åˆ°ï¼ˆæ„å‘³ç€æµ‹è¯•åªè°ƒç”¨æ­£ç¡®çš„è·¯å¾„ï¼Œè€Œä¸ç®¡åº”ç”¨ç¨‹åºçš„é”™è¯¯è¡Œä¸ºï¼‰

å¦‚æœè¦†ç›–ç‡ä½äºæŸä¸ªé˜ˆå€¼ï¼Œåˆ™å°†æµ‹è¯•ç»“æœè®¾ç½®ä¸ºå¤±è´¥ã€‚

**Otherwise:** å½“ä½ çš„å¤§éƒ¨åˆ†ä»£ç æœªè¢«æµ‹è¯•è¦†ç›–æ—¶ï¼Œå°†ä¸ä¼šæœ‰ä»»ä½•è‡ªåŠ¨åŒ–å·¥å…·å‘Šè¯‰ä½ ã€‚


## 4.7 æ£€æŸ¥è¿‡æ—¶çš„ä¾èµ–åŒ…

**TL;DR:** ä½¿ç”¨ä½ å–œæ¬¢çš„å·¥å…·ï¼ˆä¾‹å¦‚ `npm outdated` æˆ– [npm-check-updates](https://www.npmjs.com/package/npm-check-updates)ï¼‰æ¥æ£€æµ‹å·²å®‰è£…çš„ä¾èµ–åŒ…æ˜¯å¦è¿‡æœŸï¼Œå°†æ­¤æ£€æŸ¥æ”¾åˆ° CI  ä¸­è¿›è¡Œï¼Œåœ¨ä¸¥é‡çš„æƒ…å†µä¸‹ç”šè‡³å¯ä»¥è®©æ„å»ºå¤±è´¥ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªå¯èƒ½çš„æƒ…å†µæ˜¯å½“ä¸€ä¸ªå·²å®‰è£…çš„ä¾èµ–åŒ…æäº¤äº† 5 ä¸ªè¡¥ä¸ï¼ˆä¾‹å¦‚æœ¬åœ°ç‰ˆæœ¬æ˜¯ 1.3.1 è€Œè¿œç¨‹ç‰ˆæœ¬æ˜¯ 1.3.8ï¼‰ï¼Œæˆ–è€…å®ƒçš„ä½œè€…æŠŠå®ƒè¢«æ ‡è®°ä¸ºå¼ƒç”¨æ—¶ â€”â€” ç»ˆæ­¢æ„å»ºå¹¶é˜»æ­¢éƒ¨ç½²è¯¥ç‰ˆæœ¬ã€‚

**Otherwise:** ä½ çš„äº§å“å°†ä¼šè¿è¡Œè¢«ä½œè€…æ˜ç¡®æ ‡è®°å±é™©çš„ä¾èµ–åŒ…ã€‚

## 4.8 ä½¿ç”¨ docker-compose è¿›è¡Œ e2e æµ‹è¯•

**TL;DR:** åŒ…å«å®æ—¶æ•°æ®çš„ç«¯åˆ°ç«¯ï¼ˆe2eï¼‰æµ‹è¯•ï¼Œæ›¾ç»æ˜¯ CI è¿‡ç¨‹ä¸­æœ€è–„å¼±çš„ç¯èŠ‚ï¼Œå› ä¸ºå®ƒä¾èµ–äºå¤šä¸ªåƒæ•°æ®åº“ä¸€æ ·ç¹é‡çš„æœåŠ¡ã€‚`docker-compose` é€šè¿‡ä½¿ç”¨ç®€å•çš„æ–‡æœ¬æ–‡ä»¶å’Œå‘½ä»¤æ¥åˆ¶ä½œç±»ä¼¼çš„ç”Ÿäº§ç¯å¢ƒå°†è¿™ä¸ªé—®é¢˜å˜å¾—ç®€å•ã€‚å®ƒå…è®¸åˆ¶å®šæ‰€æœ‰çš„ä¾èµ–æœåŠ¡ï¼Œå¦‚æ•°æ®åº“å’Œç½‘ç»œéš”ç¦»æ¥è¿›è¡Œ e2e æµ‹è¯•ã€‚æœ€åä½†å¹¶éæœ€ä¸é‡è¦çš„ä¸€ç‚¹æ˜¯ï¼Œå®ƒå¯ä»¥åœ¨æ¯ä¸ªæµ‹è¯•å¥—ä»¶è°ƒç”¨ä¹‹å‰çš„ä¿æŒæ— çŠ¶æ€ç¯å¢ƒï¼Œå¹¶ä¸”åœ¨ä½¿ç”¨ä¹‹åç«‹åˆ»é”€æ¯ã€‚

**Otherwise:** æ²¡æœ‰ docker-compose å›¢é˜Ÿå¿…é¡»ä¸ºæ¯ä¸ªæµ‹è¯•ç¯å¢ƒï¼ˆåŒ…æ‹¬å¼€å‘è€…çš„æœºå™¨ï¼‰ç»´æŠ¤ä¸€ä¸ªæµ‹è¯•æ•°æ®åº“ï¼Œå¹¶ä¿æŒæ‰€æœ‰æ•°æ®åº“åŒæ­¥ä»¥ä½¿æµ‹è¯•ç»“æœä¸ä¼šå› ç¯å¢ƒè€Œå¼‚ã€‚

# `5 æŠ•å…¥ç”Ÿäº§ä½¿ç”¨`

## 5.1 ç›‘æ§!

**TL;DR:** ç›‘æ§æ˜¯ä¸€ä¸ªæŠ¢åœ¨ç”¨æˆ·ä¹‹å‰å‘ç°é—®é¢˜çš„æ¸¸æˆ â€”â€” æ˜¾ç„¶è¿™åº”è¯¥è¢«èµ‹äºˆå‰æ‰€æœªæœ‰çš„é‡è¦æ€§ã€‚å¸‚åœºäººå‘˜ä¼šå› ä¸ºæŠ¥ä»·è€Œä¸çŸ¥æ‰€æªï¼Œå› æ­¤å¯ä»¥è€ƒè™‘ä»å®šä¹‰ä½ å¿…é¡»è¦çš„åŸºæœ¬æŒ‡æ ‡å¼€å§‹ï¼ˆå¦‚CPU, å†…å­˜, Node è¿›ç¨‹çš„å†…å­˜ (å°‘äº 1.4GB), æœ€è¿‘ä¸€åˆ†é’Ÿçš„é”™è¯¯æ•°, è¿›ç¨‹é‡å¯æ¬¡æ•°, å¹³å‡å“åº”æ—¶é—´ï¼‰ï¼Œç„¶åå†å»çœ‹çœ‹æ›´å¤šçš„èŠ±å¼åŠŸèƒ½ï¼ˆå¦‚ DB æ€§èƒ½åˆ†æï¼Œè·¨æœåŠ¡æµ‹é‡ï¼Œå‰ç«¯é›†æˆï¼Œå°†åŸå§‹æ•°æ®å±•ç¤ºç»™è‡ªå®šä¹‰ BI å®¢æˆ·ç«¯, slack æé†’ç­‰ï¼‰ï¼Œé€‰æ‹©èƒ½å¤Ÿæ»¡è¶³ä½ æ¡ä»¶çš„è§£å†³æ–¹æ¡ˆã€‚

**Otherwise:** å¤±è´¥ === å¤±æœ›çš„ç”¨æˆ·ã€‚ å›¾æ£®ç ´ğŸ¤“ã€‚

ğŸ”— [**Read More: Monitoring!**](https://github.com/i0natan/nodebestpractices/blob/master/sections/production/monitoring.md)


## 5.2 ä½¿ç”¨èªæ˜çš„æ—¥å¿—æ¥æé«˜é€æ˜åº¦

**TL;DR:** æ—¥å¿—å¯èƒ½æ˜¯ä¸€ä¸ªå……æ»¡è°ƒè¯•è¯­å¥çš„æ„šè ¢ä»“åº“ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªè®²è¿°åº”ç”¨ç¨‹åºæ•…äº‹çš„æ‹¥æœ‰æ¼‚äº®é¢æ¿çš„å¯åŠ¨å™¨ã€‚ä»ç¬¬ 1 å¤©å¼€å§‹è®¡åˆ’ä½ çš„æ—¥å¿—å¹³å°ï¼šå¦‚ä½•æ”¶é›†ï¼Œå­˜å‚¨å’Œåˆ†ææ—¥å¿—ä»¥ç¡®ä¿æ‰€éœ€ä¿¡æ¯ï¼ˆä¾‹å¦‚ï¼Œé”™è¯¯ç‡ï¼ŒæœåŠ¡å’ŒæœåŠ¡ä¹‹é—´çš„æ•´ä¸ªäº‹åŠ¡çš„è¿½è¸ªç­‰ï¼‰èƒ½å¤Ÿè¢«çœŸæ­£æå–ã€‚

**Otherwise:** ä½ æœ€ç»ˆä¼šç¢°åˆ°ä¸€ä¸ªå¾ˆéš¾ç†è§£çš„é»‘ç›’ï¼Œç„¶åä½ å¼€å§‹é‡å†™æ‰€æœ‰çš„æ—¥å¿—è¯­å¥æ¥æ·»åŠ é¢å¤–çš„ä¿¡æ¯ã€‚

ğŸ”— [**Read More: Increase transparency using smart logging**](https://github.com/i0natan/nodebestpractices/blob/master/sections/production/smartlogging.md)

## 5.3 å°†ä»»ä½•å¯èƒ½çš„ä¸œè¥¿ï¼ˆä¾‹å¦‚gzipï¼ŒSSLï¼‰æ”¾åœ¨åå‘ä»£ç†ä¸­

**TL;DR:** Node åœ¨æ‰§è¡Œ CPU å¯†é›†å‹ä»»åŠ¡ï¼ˆå¦‚gzippingï¼ŒSSLç»ˆæ­¢ç­‰ï¼‰æ—¶æ€§èƒ½éå¸¸ç³Ÿç³•ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨ â€œçœŸæ­£çš„â€ ä¸­é—´ä»¶æœåŠ¡ï¼Œå¦‚ nginxï¼ŒHAproxy æˆ– äº‘å¹³å°æœåŠ¡ä½œä¸ºä»£æ›¿ã€‚

**Otherwise:** ä½ å¯æ€œçš„å•çº¿ç¨‹å°†ç»§ç»­å¿™äºåšç½‘ç»œä»»åŠ¡ï¼Œè€Œä¸æ˜¯å¤„ç†ä½ åº”ç”¨ç¨‹åºçš„æ ¸å¿ƒéœ€æ±‚ï¼Œå› æ­¤æ€§èƒ½ä¼šç›¸åº”åœ°é™ä½ã€‚

ğŸ”— [**Read More: Delegate anything possible (e.g. gzip, SSL) to a reverse proxy**](https://github.com/i0natan/nodebestpractices/blob/master/sections/production/delegatetoproxy.md)

## 5.4 é”å®šä¾èµ–ç‰ˆæœ¬

**TL;DR:** ä½ çš„ä»£ç åœ¨æ‰€æœ‰ç¯å¢ƒä¸­å¿…é¡»ç›¸åŒï¼Œä½†ä»¤äººæƒŠè®¶çš„æ˜¯ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒNPM å…è®¸ä¾èµ–é¡¹è·¨ç¯å¢ƒåç§» â€”â€” å½“ä½ åœ¨ä¸åŒç¯å¢ƒä¸‹å®‰è£…ä¾èµ–åŒ…æ—¶ï¼Œå®ƒä¼šå°è¯•æ‹‰å–ä¿®è®¢å·æœ€æ–°çš„ç‰ˆæœ¬ã€‚é€šè¿‡ä½¿ç”¨ NPM é…ç½®æ–‡ä»¶ `.npmrc` å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå®ƒå‘Šè¯‰æ¯ä¸ªç¯å¢ƒä¿å­˜æ¯ä¸ªæ¨¡å—çš„ç¡®åˆ‡ï¼ˆè€Œä¸æ˜¯æœ€æ–°ï¼‰ç‰ˆæœ¬ã€‚æˆ–è€…ï¼Œä¸ºäº†æ›´ç»†ç²’åº¦çš„æ§åˆ¶ï¼Œå¯ä»¥ä½¿ç”¨ NPM `shrinkwrap`ã€‚     
æ›´æ–°ï¼šä» NPM5 å¼€å§‹ï¼Œä¾èµ–é¡¹è¢«é»˜è®¤é”å®šã€‚æ–°çš„æ‰“åŒ…å·¥å…· Yarn ä¹Ÿé»˜è®¤äº†é”å®šäº†ç‰ˆæœ¬ã€‚

**Otherwise:** QA å°†å½»åº•æµ‹è¯•ä»£ç å¹¶åŒæ„ä½¿ç”¨åœ¨ç”Ÿäº§ä¸­å¯èƒ½è¡¨ç°ä¸åŒçš„ç‰ˆæœ¬ã€‚æ›´ç³Ÿçš„æ˜¯ï¼ŒåŒä¸€ä¸ªç”Ÿäº§é›†ç¾¤ä¸­çš„ä¸åŒæœåŠ¡å™¨å¯èƒ½ä¼šè¿è¡Œä¸åŒçš„ä»£ç ã€‚

**PS:** é”å®šä¾èµ–ç‰ˆæœ¬ä¹Ÿä¼šå¸¦æ¥ä¸€äº›é—®é¢˜ï¼š

* ä¸šåŠ¡ä½¿ç”¨ç‰ˆæœ¬å’Œå®é™…ç‰ˆæœ¬ç›¸å·®å·¨å¤§ï¼Œå‡çº§æˆæœ¬é«˜
* æœ‰äº›ä¾èµ–åŒ…çš„ Bug ä¿®å¤æˆ–åŠŸèƒ½ä¼˜åŒ–æ— æ³•å¾—åˆ°åŠæ—¶æ›´æ–°ï¼Œæ¯”å¦‚ä¸€äº›åº•å±‚ä¾èµ–ä¿®å¤äº† OOM é—®é¢˜
* å…¶ä»–ç­‰

æ‰€ä»¥æœ‰ç›¸å½“ä¸€éƒ¨åˆ†å›¢é˜Ÿä¸é€‰æ‹©é”å®šç‰ˆæœ¬ï¼Œä¾é é€‰æ‹©ç¬¦åˆè¯­ä¹‰åŒ–ç‰ˆæœ¬çš„å¼€æºæ¨¡å—å’Œè‡ªåŠ¨åŒ–æµ‹è¯•ç­‰æ¥è§„é¿ä¾èµ–è‡ªåŠ¨å‡çº§å¯¼è‡´çš„é—®é¢˜ã€‚   
æˆ‘ä¸ªäººè§‰å¾—å‡ ä¹éš¾ä»¥åšåˆ°åœ¨ä¸€ä¸ªé¡¹ç›®é‡Œæ‰€ä½¿ç”¨çš„æ¨¡å—éƒ½æ˜¯å®Œå…¨æŒ‰è¯­ä¹‰åŒ–ç‰ˆæœ¬å‘å¸ƒçš„ï¼ˆä¾‹å¦‚ï¼šæœ‰äº›å¼€æºæ¨¡å—çš„è´¡çŒ®è€…æäº¤äº†ä¸€ä¸ªå° patch ä½†æ˜¯å´å¼•å…¥äº†è‡ªå·±ä¹Ÿæ²¡å‘ç°çš„æ–°é—®é¢˜ï¼‰æ‰€ä»¥å€¾å‘äºä½¿ç”¨ä¾èµ–é”å®šï¼Œå¹¶åœ¨ä¸€ä¸ªå°çš„å‘¨æœŸé‡Œè¿›è¡ŒåŠæ—¶æ›´æ–°ã€‚

ğŸ”— [**Read More: Lock dependencies**](https://github.com/i0natan/nodebestpractices/blob/master/sections/production/lockdependencies.md)

## 5.5 ä½¿ç”¨æ­£ç¡®çš„å·¥å…·æ¥è¿›è¡Œè¿›ç¨‹å®ˆæŠ¤

**TL;DR:** è¿›ç¨‹å¿…é¡»ç»§ç»­è¿è¡Œå¹¶ä¸”èƒ½åœ¨å¤±è´¥ä¹‹åé‡å¯ã€‚å¯¹äºç®€å•çš„æƒ…å†µï¼Œåƒ PM2 è¿™æ ·çš„å·¥å…·å¯èƒ½å°±è¶³å¤Ÿäº†ï¼Œä½†åœ¨å½“ä»Š `dockerized` çš„ä¸–ç•Œä¸­ï¼Œé›†ç¾¤ç®¡ç†å·¥å…·ä¹Ÿåº”è¯¥è¢«è€ƒè™‘åœ¨å†…ã€‚

**Otherwise:** è¿è¡Œæ•°åä¸ªæ²¡æœ‰æ˜ç¡®ç­–ç•¥çš„å®ä¾‹ä»¥åŠå¤ªå¤šçš„å·¥å…·ä¸€èµ·ï¼ˆé›†ç¾¤ç®¡ç†ï¼Œdockerï¼ŒPM2ï¼‰å¯èƒ½ä¼šè®© devops é™·å…¥æ··ä¹±ã€‚

ğŸ”— [**Read More: Guard process uptime using the right tool**](https://github.com/i0natan/nodebestpractices/blob/master/sections/production/guardprocess.md)


## 5.6 åˆ©ç”¨æ‰€æœ‰çš„ CPU

**TL;DR:** åœ¨å…¶åŸºæœ¬å½¢å¼é‡Œï¼ŒNode åº”ç”¨åœ¨å•ä¸ª CPU ä¸Šè¿è¡Œï¼Œè€Œå…¶ä»– CPU éƒ½å¾ˆç©ºé—²ã€‚ä½ åº”è¯¥å¤åˆ¶ Node è¿›ç¨‹å¹¶åˆ©ç”¨æ‰€æœ‰ CPU â€”â€” å¯¹äºä¸­å°å‹åº”ç”¨ï¼Œä½ å¯ä»¥ä½¿ç”¨ `Node Cluster` æˆ–è€… `PM2`ã€‚å¯¹äºæ›´å¤§çš„åº”ç”¨ï¼Œè€ƒè™‘ä½¿ç”¨ä¸€äº› Docker é›†ç¾¤ï¼ˆä¾‹å¦‚ `K8S`ï¼Œ`ECS`ï¼‰å·¥å…·æˆ–åŸºäº Linux init ç³»ç»Ÿï¼ˆä¾‹å¦‚ `systemd`ï¼‰çš„éƒ¨ç½²è„šæœ¬æ¥å¤åˆ¶è¿›ç¨‹ã€‚

**Otherwise:** ä½ çš„åº”ç”¨ç¨‹åºåªä½¿ç”¨äº†å…¨éƒ¨èµ„æºçš„ 25ï¼…ï¼Œç”šè‡³æ›´å°‘ã€‚è¯·æ³¨æ„ï¼Œä¸€ä¸ªå…¸å‹çš„æœåŠ¡å™¨æœ‰ 4 ä¸ªæˆ–æ›´å¤šçš„ CPU å†…æ ¸ï¼Œæ­£å¸¸çš„ Node.JS çš„éƒ¨ç½²åªèƒ½ä½¿ç”¨ 1 ä¸ªï¼ˆå°±ç®—æ˜¯ä½¿ç”¨äº† `AWS beanstalk` ä¹‹ç±»çš„ PaaS æœåŠ¡ï¼ï¼‰

ğŸ”— [**Read More: Utilize all CPU cores**](https://github.com/i0natan/nodebestpractices/blob/master/sections/production/utilizecpu.md)

## 5.7 åˆ›å»ºä¸€ä¸ª â€œç»´æŠ¤ç«¯ç‚¹â€

**TL;DR:** åœ¨å®‰å…¨çš„ç¯å¢ƒä¸­æš´éœ²ä¸€ç»„ä¸ç³»ç»Ÿç›¸å…³çš„ APIï¼Œå¦‚å†…å­˜ä½¿ç”¨å’Œ REPL ç­‰ã€‚å°½ç®¡å¼ºçƒˆå»ºè®®ä½¿ç”¨ä¹…ç»è€ƒéªŒçš„æ ‡å‡†å·¥å…·ï¼Œä½†é€šè¿‡ä»£ç å¯ä»¥è½»æ¾è·å¾—ä¸€äº›æœ‰ä»·å€¼çš„ä¿¡æ¯ä»¥åŠæ‰§è¡Œä¸€äº›ç›¸å…³æ“ä½œã€‚

**Otherwise:** ä½ ä¼šå‘ç°ä½ æ­£åœ¨æ‰§è¡Œè®¸å¤š â€œè¯Šæ–­éƒ¨ç½²â€ â€”â€” ä¸ºäº†æå–ä¸€äº›ä¿¡æ¯ç”¨ä½œè¯Šæ–­è€Œå°†ä»£ç å‘å¸ƒåˆ°ç”Ÿæˆç¯å¢ƒã€‚

ğŸ”— [**Read More: Create a â€˜maintenance endpointâ€™**](https://github.com/i0natan/nodebestpractices/blob/master/sections/production/createmaintenanceendpoint.md)

## 5.8 ä½¿ç”¨ APM äº§å“æ¥å‘ç°é”™è¯¯å’Œåœæœºæ—¶é—´

**TL;DR:** ç›‘æ§å’Œæ€§èƒ½äº§å“ï¼ˆåˆç§° APMï¼‰ä¸»åŠ¨æµ‹é‡ä½ çš„ä»£ç å’Œ APIï¼Œæ‰€ä»¥ä»–ä»¬å¯ä»¥è¶…è¶Šä¼ ç»Ÿçš„ç›‘æ§ï¼Œå¹¶èƒ½è·¨è¶ŠæœåŠ¡å’Œå±‚çº§æ¥è¡¡é‡æ•´ä½“ç”¨æˆ·ä½“éªŒã€‚ä¾‹å¦‚ï¼ŒæŸäº› APM äº§å“å¯èƒ½ä¼šçªå‡ºå±•ç¤ºåœ¨ç”¨æˆ·ç»ˆç«¯åŠ è½½é€Ÿåº¦è¿‡æ…¢çš„äº‹åŠ¡ï¼ŒåŒæ—¶æç¤ºæ ¹æœ¬åŸå› ã€‚

**Otherwise:** ä½ å¯èƒ½ä¼šèŠ±å¾ˆå¤šç²¾åŠ›å»æµ‹é‡ API çš„æ€§èƒ½å’Œåœæœºæ—¶é—´ï¼Œè€Œä¸”å¾ˆå¯èƒ½ä½ æ°¸è¿œä¹Ÿä¸ä¼šå¯Ÿè§‰åˆ°å“ªäº›éƒ¨åˆ†æ‰æ˜¯åœ¨çœŸå®æƒ…å†µä¸‹æœ€æ…¢çš„ï¼Œä»¥åŠå®ƒæ˜¯å¦‚ä½•å½±å“ç”¨æˆ·ä½“éªŒçš„ã€‚

ğŸ”— [**Read More: Discover errors and downtime using APM products**](https://github.com/i0natan/nodebestpractices/blob/master/sections/production/apmproducts.md)


## 5.9 ä½¿ä½ çš„ä»£ç  â€œç”Ÿäº§å°±ç»ªâ€

**TL;DR:** ä»¥ç»“æœä¸ºå¯¼å‘å†™ç ï¼Œä»ç¬¬ 1 å¤©å¼€å§‹è®¡åˆ’ä¸Šçº¿ã€‚è¿™å¬èµ·æ¥æœ‰äº›æ¨¡ç³Šï¼Œæ‰€ä»¥æˆ‘æ±‡æ€»äº†ä¸€äº›ä¸ç”Ÿäº§ç»´æŠ¤å¯†åˆ‡ç›¸å…³çš„å¼€å‘æŠ€å·§ï¼š

* [Twelve factors](https://12factor.net/)
	* ä¸€ä»½åŸºå‡†ä»£ç ï¼Œå¤šä»½éƒ¨ç½²
	* æ˜¾å¼å£°æ˜ä¾èµ–å…³ç³»
	* åœ¨ç¯å¢ƒå˜é‡ä¸­å­˜å‚¨é…ç½®
	* æŠŠåç«¯æœåŠ¡å½“ä½œé™„åŠ èµ„æº
	* ä¸¥æ ¼åˆ†ç¦»æ„å»ºå’Œè¿è¡Œ
	* ä»¥ä¸€ä¸ªæˆ–å¤šä¸ªæ— çŠ¶æ€è¿›ç¨‹è¿è¡Œåº”ç”¨
	* é€šè¿‡ç«¯å£ç»‘å®šæä¾›æœåŠ¡
	* é€šè¿‡è¿›ç¨‹æ¨¡å‹è¿›è¡Œæ‰©å±•
	* å¿«é€Ÿå¯åŠ¨å’Œä¼˜é›…ç»ˆæ­¢å¯æœ€å¤§åŒ–é²æ£’æ€§
	* å°½å¯èƒ½çš„ä¿æŒå¼€å‘ã€é¢„å‘å¸ƒã€çº¿ä¸Šç¯å¢ƒç›¸åŒ
	* æŠŠæ—¥å¿—å½“ä½œäº‹ä»¶æµ
	* åå°ç®¡ç†ä»»åŠ¡å½“ä½œä¸€æ¬¡æ€§è¿›ç¨‹è¿è¡Œ
* ä¿æŒæ— çŠ¶æ€ â€”â€” ä¸åœ¨ç‰¹å®šçš„æœåŠ¡å™¨ä¸Šä¿å­˜çŠ¶æ€æ•°æ®
* ç¼“å­˜ â€”â€” å¤§é‡ä½¿ç”¨ç¼“å­˜ï¼Œä½†ä¸ä¼šå› ç¼“å­˜ä¸åŒ¹é…è€Œå¤±è´¥
* æµ‹è¯•å†…å­˜ â€”â€” è¡¡é‡å†…å­˜ä½¿ç”¨å’Œæ³„æ¼æƒ…å†µä¹Ÿæ˜¯å¼€å‘æµç¨‹çš„ä¸€éƒ¨åˆ†ï¼Œç±»ä¼¼ `memwatch` ä¹‹ç±»çš„å·¥å…·å¯ä»¥æå¤§åœ°ç®€åŒ–è¿™é¡¹ä»»åŠ¡
* å‘½åå‡½æ•° â€”â€” æœ€å°åŒ–åŒ¿åå‡½æ•°çš„ä½¿ç”¨ï¼ˆå³å†…è”å›è°ƒï¼‰ï¼Œå› ä¸ºå…¸å‹çš„å†…å­˜åˆ†æå™¨ä¼šæä¾›æ¯ä¸ªå‘½åæ–¹æ³•çš„å†…å­˜ä½¿ç”¨é‡ã€‚
* ä½¿ç”¨ CI å·¥å…· â€”â€” ä½¿ç”¨ CI å·¥å…·åœ¨å‘å¸ƒåˆ°ç”Ÿäº§ç¯å¢ƒä¹‹å‰è¿›è¡Œæ•…éšœæ£€æµ‹ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ ESLint æ¥æ£€æµ‹å¼•ç”¨é”™è¯¯å’Œæœªå®šä¹‰çš„å˜é‡ã€‚ä½¿ç”¨ `-trace-sync-io` æ¥æ ‡è¯†ä½¿ç”¨åŒæ­¥ API çš„ä»£ç 
* é”™è¯¯ç®¡ç† â€”â€” é”™è¯¯å¤„ç†æ˜¯æ•´ä¸ª Node.JS ç½‘ç«™çš„è–„å¼±ç¯èŠ‚ã€‚å¾ˆå¤š Node è¿›ç¨‹å› ä¸ºå°é”™è¯¯è€Œå´©æºƒï¼Œè€Œå…¶ä»– Node è¿›ç¨‹åˆ™å¤„äºæ•…éšœçŠ¶æ€ã€‚

**Otherwise:** ä¸€ä¸ª IT/devops ä¸–ç•Œå† å†›ä¹Ÿæ‹¯æ•‘ä¸äº†ä¸€ä¸ªå†™å¾—å¾ˆçƒ‚çš„ç³»ç»Ÿã€‚

ğŸ”— [**Read More: Make your code production-ready**](https://github.com/i0natan/nodebestpractices/blob/master/sections/production/productoncode.md)


## 5.10 ç›‘æµ‹å†…å­˜ä½¿ç”¨

**TL;DR:** Node.js å’Œå†…å­˜ä¹‹é—´çš„äº‰è®®ï¼šv8 å¼•æ“å¯¹å†…å­˜ä½¿ç”¨ï¼ˆ1.4GBï¼‰å…·æœ‰è½¯é™åˆ¶ï¼Œå¹¶ä¸”åœ¨ Node çš„ä»£ç ä¸­å­˜åœ¨å·²çŸ¥çš„é€”å¾„æ¥ä½¿å†…å­˜æ³„æ¼ï¼Œå› æ­¤ç›‘æµ‹ Node è¿›ç¨‹çš„å†…å­˜æ˜¯å¿…é¡»çš„ã€‚åœ¨å°å‹åº”ç”¨ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨ shell å‘½ä»¤å®šæœŸæµ‹é‡å†…å­˜ï¼Œä½†åœ¨å¤§ä¸­å‹åº”ç”¨ä¸­ï¼Œè¯·è€ƒè™‘å°†å†…å­˜ç›‘æµ‹æ”¾å…¥åˆ°å¼ºå¤§çš„ç›‘æ§ç³»ç»Ÿä¸­ã€‚

**Otherwise:** ä½ çš„è¿›ç¨‹å†…å­˜å¯èƒ½ä¼šå’Œ Wallmart é‡Œå‘ç”Ÿçš„æƒ…å†µä¸€æ ·ï¼Œæ¯å¤©æ³„æ¼ 100mã€‚

**PS:** è¿™ä¸ªå¯ä»¥ç»“åˆç›‘æ§å’ŒæŠ¥è­¦æ¥åšï¼Œå¦‚æœå‘ç”Ÿå†…å­˜æ³„æ¼ï¼Œä¸€äº› APM ä¹Ÿèƒ½å¸®åŠ©è¿›è¡Œåˆ†æå®šä½ã€‚

ğŸ”— [**Read More: Measure and guard the memory usage**](https://github.com/i0natan/nodebestpractices/blob/master/sections/production/measurememory.md)


## 5.11. è®©å‰ç«¯èµ„æºå’Œ Node è§£è€¦

**TL;DR:** ä½¿ç”¨ä¸“ç”¨ä¸­é—´ä»¶ï¼ˆnginxï¼ŒS3ï¼ŒCDNï¼‰æœåŠ¡å‰ç«¯å†…å®¹ï¼Œå› ä¸º Node æ˜¯å•çº¿ç¨‹æ¨¡å¼ï¼Œåœ¨å¤„ç†å¤šä¸ªé™æ€æ–‡ä»¶æ—¶ï¼Œå…¶æ€§èƒ½ä¼šå—åˆ°å½±å“ã€‚

**Otherwise:** ä½ çš„å•ä¸ª Node çº¿ç¨‹å°†å¿™äºä¼ è¾“æ•°ç™¾ä¸ª html/images/angular/react æ–‡ä»¶æµï¼Œè€Œä¸æ˜¯å°†æ‰€æœ‰èµ„æºåˆ†ç»™å®ƒçœŸæ­£çš„ç›®çš„ â€”â€” æä¾›åŠ¨æ€å†…å®¹

ğŸ”— [**Read More: Get your frontend assets out of Node**](https://github.com/i0natan/nodebestpractices/blob/master/sections/production/frontendout.md)

## 5.12 æ— çŠ¶æ€ï¼Œæ¯å¤©éƒ½æ€æ‰ä½ çš„æœåŠ¡

**TL;DR:** å°†æ— ä»»ä»€ä¹ˆç±»å‹çš„æ•°æ®ï¼ˆä¾‹å¦‚ï¼Œç”¨æˆ·ä¼šè¯ï¼Œç¼“å­˜ï¼Œä¸Šä¼ çš„æ–‡ä»¶ï¼‰æ”¾åˆ°å¤–éƒ¨å­˜å‚¨ä¸­ã€‚è€ƒè™‘å®šæœŸ â€œæ€æ­»â€ ä½ çš„æœåŠ¡ï¼Œæˆ–è€…ä½¿ç”¨æ˜ç¡®å¼ºåˆ¶æ‰§è¡Œæ— çŠ¶æ€è¡Œä¸ºçš„â€œæ— æœåŠ¡å™¨â€å¹³å°ï¼ˆä¾‹å¦‚AWS Lambdaï¼‰ã€‚

**Otherwise:** ç‰¹å®šçš„æœåŠ¡å™¨å‡ºç°æ•…éšœå°†å¯¼è‡´æ•´ä¸ªåº”ç”¨ç¨‹åºåœæœºï¼Œè€Œä¸æ˜¯ä»…ä»…æ€æ‰æœ‰æ•…éšœçš„çš„æœºå™¨ã€‚è€Œä¸”ï¼Œç”±äºå¯¹ç‰¹å®šæœåŠ¡å™¨çš„ä¾èµ–ï¼Œå¼¹æ€§æ‰©å±•å°†å˜å¾—æ›´åŠ è‰°éš¾ã€‚

ğŸ”— [**Read More: Be stateless, kill your Servers almost every day**](https://github.com/i0natan/nodebestpractices/blob/master/sections/production/bestateless.md)


## 5.13 ä½¿ç”¨æ¼æ´è‡ªåŠ¨æ£€æµ‹å·¥å…·
**TL;DR:** å³ä¾¿æ˜¯æœ€å‡ºåçš„æ¨¡å—åŒ…ï¼Œä¾‹å¦‚ `Express`ï¼Œä¹Ÿå­˜åœ¨æ¼æ´ã€‚å¯ä»¥é€šè¿‡ä½¿ç”¨ç¤¾åŒºæˆ–å•†ä¸šå·¥å…·ï¼Œä¸æ–­åœ°æ£€æŸ¥æ¼æ´å¹¶æŠ¥å‘Šï¼ˆæœ¬åœ°æˆ–GitHubï¼‰ï¼Œæœ‰äº›æ¼æ´ç”šè‡³å¯ä»¥ç«‹å³ä¿®è¡¥ã€‚

**Otherwise:** ä¸ç”¨ä¸“ç”¨å·¥å…·æ¥è¿›è¡Œä»£ç æ¼æ´ä¿æŠ¤ï¼Œé‚£ä¹ˆä½ éœ€è¦ä¸æ–­åœ°å…³æ³¨æœ‰å…³æ–°æ¼æ´çš„æ¶ˆæ¯ã€‚è¿™æ˜¯éå¸¸æ— èŠçš„ã€‚

ğŸ”— [**Read More: Use tools that automatically detect vulnerabilities**](https://github.com/i0natan/nodebestpractices/blob/master/sections/production/detectvulnerabilities.md)


## 5.14 ä¸ºæ¯ä¸ªæ—¥å¿—è¯­å¥åˆ†é… â€œTransactionIdâ€

**TL;DR:** ä¸ºå•ä¸ªè¯·æ±‚ä¸­çš„æ¯ä¸ªæ—¥å¿—æ¡ç›®åˆ†é…ç›¸åŒçš„æ ‡è¯†ç¬¦ `transaction-idï¼š{some value}`ã€‚
ä¹‹åï¼Œåœ¨æ£€æŸ¥æ—¥å¿—ä¸­çš„é”™è¯¯æ—¶ï¼Œå¯ä»¥è½»æ¾åœ°äº†è§£é”™è¯¯ä¸Šä¸‹æ–‡ã€‚ä¸å¹¸çš„æ˜¯ï¼Œç”±äº Node çš„å¼‚æ­¥æ€§è´¨ï¼Œå®ç°èµ·æ¥å¹¶ä¸å®¹æ˜“ï¼Œè¯·å‚è€ƒé“¾æ¥é‡Œçš„ä»£ç ç¤ºä¾‹

**Otherwise:** åœ¨æ²¡æœ‰ä¸Šä¸‹æ–‡çš„æƒ…å†µä¸‹æŸ¥çœ‹ç”Ÿäº§ç¯å¢ƒé‡Œçš„é”™è¯¯æ—¥å¿—ä¼šä½¿å¾—æ¨æ–­é—®é¢˜çš„åŸå› å˜å¾—æ›´åŠ å›°éš¾å’Œç¼“æ…¢ã€‚

**PS:** å¯ä»¥åœ¨ API ç½‘å…³é‡Œä¸ºæ¯ä¸€ä¸ªè¯·æ±‚ç”Ÿæˆå”¯ä¸€çš„ `requst-id`ï¼Œä¹‹åçš„æ¯æ¬¡å†…éƒ¨è°ƒç”¨éƒ½è¿›è¡Œé€ä¼ ï¼Œå¹¶ä¸”åœ¨ç›¸å…³çš„æ¯ä¸ªæ—¥å¿—ä¸­è¿›è¡Œæ‰“å°ã€‚å†é…åˆä¸Š `ELK` å°±èƒ½å¤Ÿéå¸¸æ–¹ä¾¿çš„æŸ¥è¯¢åˆ°ä¸€æ¬¡è¯·æ±‚å’Œå…¶ç›¸å…³çš„å…¨éƒ¨äº‹åŠ¡äº†ã€‚

ğŸ”— [**Read More: Assign â€˜TransactionIdâ€™ to each log statement**](https://github.com/i0natan/nodebestpractices/blob/master/sections/production/assigntransactionid.md)


## 5.15 è®¾ç½® NODE_ENV=production

**TL;DR:** å°† `NODE_ENV` è®¾ç½®ä¸º `production` æˆ– `development` æ¥æ ‡è®°ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–æ˜¯å¦åº”è¯¥è¢«å¯ç”¨ â€”â€” è®¸å¤š NPM åŒ…ä¼šæ ¹æ®å½“å‰ç¯å¢ƒæ¥å†³å®šæ˜¯å¦ä¼˜åŒ–ä»£ç ã€‚

**Otherwise:** çœç•¥è¿™ä¸ªç®€å•çš„å±æ€§å¯èƒ½ä¼šå¤§å¤§é™ä½æ€§èƒ½ã€‚ä¾‹å¦‚ï¼Œå½“ä½¿ç”¨ Express è¿›è¡ŒæœåŠ¡å™¨ç«¯æ¸²æŸ“æ—¶ï¼Œå¿½ç•¥ NODE_ENV ä¼šä½¿é€Ÿåº¦é™ä½ä¸‰å€ï¼

ğŸ”— [**Read More: Set NODE_ENV=production**](https://github.com/i0natan/nodebestpractices/blob/master/sections/production/setnodeenv.md)

## 5.16 è®¾è®¡è‡ªåŠ¨çš„ï¼ŒåŸå­çš„ï¼Œé›¶åœæœºçš„éƒ¨ç½²

**TL;DR:** ç ”ç©¶è¡¨æ˜ï¼Œæ‰§è¡Œæ›´å¤šæ¬¡éƒ¨ç½²çš„å›¢é˜Ÿå‡ºç°ä¸¥é‡ç”Ÿäº§ç¯å¢ƒé—®é¢˜çš„æ¦‚ç‡æ›´ä½ã€‚å¿«é€Ÿçš„è‡ªåŠ¨åŒ–éƒ¨ç½²æ²¡æœ‰æ‰‹åŠ¨æ“ä½œå’ŒæœåŠ¡å½“æœºçš„é£é™©ï¼Œå¤§å¤§æ”¹å–„äº†éƒ¨ç½²æµç¨‹ã€‚ä½ æˆ–è®¸åº”è¯¥ä½¿ç”¨ Docker å’Œ CI å·¥å…·æ¥å®ç°è¿™ä¸€ç‚¹ï¼Œå› ä¸ºå®ƒä»¬å·²ç»æˆä¸ºç®€åŒ–éƒ¨ç½²çš„è¡Œä¸šæ ‡å‡†äº†ã€‚

**Otherwise:** é•¿æ—¶é—´éƒ¨ç½² -> ç”Ÿäº§ç¯å¢ƒåœæœºæ—¶é—´ & äººä¸ºé”™è¯¯ -> å›¢é˜Ÿæ²¡æœ‰ä¿¡å¿ƒè¿›è¡Œéƒ¨ç½² -> åŠŸèƒ½å’Œå‘å¸ƒå‡å°‘ã€‚

# `6 å®‰å…¨`
## Our contributors are working on this section. Would you like to join?

# `7 æ€§èƒ½`

## Our contributors are working on this section. Would you like to join?


# Contributors
## `Yoni Goldberg`
Independent Node.JS consultant who works with customers at USA, Europe and Israel on building large-scale scalable Node applications. Many of the best practices above were first published on his blog post at [http://www.goldbergyoni.com](http://www.goldbergyoni.com). Reach Yoni at @goldbergyoni or me@goldbergyoni.com

## `Ido Richter`
ğŸ‘¨â€ğŸ’» Software engineer, ğŸŒ web developer, ğŸ¤– emojis enthusiast.

## `Refael Ackermann` [@refack](https://github.com/refack) &lt;refack@gmail.com&gt; (he/him)
Node.js Core Collaborator, been noding since 0.4, and have noded in multiple production sites. Founded `node4good` home of [`lodash-contrib`](https://github.com/node4good/lodash-contrib), [`formage`](https://github.com/node4good/formage), and [`asynctrace`](https://github.com/node4good/asynctrace). 
`refack` on freenode, Twitter, GitHub, GMail, and many other platforms. DMs are open, happy to help.

## `Bruno Scheufler` 
ğŸ’» full-stack web developer and Node.js enthusiast.
